(this.webpackJsonptirage_sort=this.webpackJsonptirage_sort||[]).push([[0],{17:function(e,t,n){},18:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=18},20:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(9),s=n.n(r),i=(n(15),n(16),n(17),n(7)),l=n(3),o=n(10),j=n(2),u=n(8),d=n.n(u),b=n(0);function m(e){for(var t=e.toLowerCase().split(" "),n=0;n<t.length;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].substring(1);return t.join(" ")}var h=function(e){var t=a.a.useState(""),n=Object(j.a)(t,2),c=n[0],r=n[1],s=a.a.useState({}),i=Object(j.a)(s,2),l=i[0],o=i[1];return a.a.useEffect((function(){document.getElementById("name").focus()}),[]),Object(b.jsxs)("form",{onSubmit:function(t){t.preventDefault(),c.match(/^[A-z\xc0-\xfa]+$/)?e.onValid(c):o({name:"Il faut choisir un nom avec des lettres."})},children:[Object(b.jsxs)("div",{className:"mb-3",children:[Object(b.jsx)("label",{for:"name",className:"form-label",children:"T'es qui ?"}),Object(b.jsxs)("div",{className:"input-group has-validation",children:[Object(b.jsx)("input",{type:"text",className:"form-control"+(l.name?" is-invalid":""),value:c,onChange:function(e){r(e.target.value)},id:"name"}),l.name&&Object(b.jsx)("div",{id:"validationServerUsernameFeedback",className:"invalid-feedback",children:l.name})]})]}),Object(b.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Valider"})]})},O=function(e){var t=a.a.useState(""),n=Object(j.a)(t,2),c=n[0],r=n[1],s=a.a.useState([]),i=Object(j.a)(s,2),l=i[0],u=i[1],d=a.a.useState({}),h=Object(j.a)(d,2),O=h[0],f=h[1];return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:Object(b.jsxs)("div",{className:"input-group has-validation",children:[Object(b.jsx)("input",{type:"text",className:"form-control"+(O.name?" is-invalid":""),value:c,onChange:function(e){r(e.target.value)},id:"name",placeholder:"Nom du film"}),O.name&&Object(b.jsx)("div",{id:"validationServerUsernameFeedback",className:"invalid-feedback",children:O.name})]})}),Object(b.jsx)("td",{children:Object(b.jsxs)("div",{className:"input-group has-validation",children:[Object(b.jsxs)("select",{multiple:!0,value:l,onChange:function(e){var t=Object(o.a)(e.target.selectedOptions).map((function(e){return e.value}));u(t)},className:"form-select"+(O.platforms?" is-invalid":""),children:[Object(b.jsx)("option",{children:"Netflix"}),Object(b.jsx)("option",{children:"Amazon"}),Object(b.jsx)("option",{children:"Disney"}),Object(b.jsx)("option",{children:"OCS"}),Object(b.jsx)("option",{children:"Salto"}),Object(b.jsx)("option",{children:"Canal+"}),Object(b.jsx)("option",{children:"Apple TV"})]}),O.platforms&&Object(b.jsx)("div",{id:"validationServerUsernameFeedback",className:"invalid-feedback",children:O.platforms})]})}),Object(b.jsx)("td",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(t){t.preventDefault();var n={};0===c.length&&(n.name="Faut choisir le nom d'un film !"),0===l.length&&(n.platforms="Faut choisir au moins une plateforme !"),f(n),0===Object.keys(n).length&&(e.onAjouter({name:m(c),platforms:l}),r(""),u([]))},children:Object(b.jsx)("i",{className:"bi bi-plus-circle-fill"})})})]})},f=function(e){var t=a.a.useState(!1),n=Object(j.a)(t,2),c=n[0],r=n[1],s=a.a.useState(""),i=Object(j.a)(s,2),l=i[0],o=i[1],u=a.a.useState({}),d=Object(j.a)(u,2),m=d[0],h=d[1],O=a.a.useState(!1),f=Object(j.a)(O,2),v=f[0],x=f[1];if(c){return v?Object(b.jsx)("div",{className:"spinner-border",role:"status",children:Object(b.jsx)("span",{className:"visually-hidden",children:"Loading..."})}):Object(b.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n={};0===l.length&&(n.name="Il faut indiquer le code du salon !"),h(n),0===Object.values(n).length&&(x(!0),e.onRejoindre(l.trim().toUpperCase()).catch((function(e){x(!1),h({name:"Impossible de rejoindre ce salon"})})))},children:[Object(b.jsx)("div",{className:"mb-3",children:Object(b.jsxs)("div",{className:"input-group has-validation",children:[Object(b.jsx)("input",{type:"text",className:"form-control"+(m.name?" is-invalid":""),value:l,onChange:function(e){o(e.target.value)},id:"name",placeholder:"Code du salon"}),m.name&&Object(b.jsx)("div",{id:"validationServerUsernameFeedback",className:"invalid-feedback",children:m.name})]})}),Object(b.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Rejoindre"})]})}return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("p",{children:"Cr\xe9er ou rejoindre un salon ?"}),Object(b.jsxs)("div",{className:"buttons",children:[Object(b.jsx)("button",{className:"btn btn-primary",type:"button",onClick:e.onCreer,children:"cr\xe9er"}),Object(b.jsx)("button",{className:"btn btn-secondary",type:"button",onClick:function(){return r(!0)},children:"rejoindre"})]})]})},v=function(e){var t=a.a.useState(null),n=Object(j.a)(t,2),c=n[0],r=n[1],s=a.a.useState(null),o=Object(j.a)(s,2),u=o[0],m=o[1],v=a.a.useState([]),x=Object(j.a)(v,2),p=x[0],g=x[1],N=a.a.useState({}),y=Object(j.a)(N,2),S=y[0],C=y[1],k=a.a.useState(null),F=Object(j.a)(k,2),R=F[0],w=F[1],A=a.a.useRef(),D=a.a.useRef();D.current=c;var T=a.a.useRef();T.current=p;var E=a.a.useRef();if(E.current=S,R)return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"countdown",children:[Object(b.jsx)("div",{className:"num5",children:"5"}),Object(b.jsx)("div",{className:"num4",children:"4"}),Object(b.jsx)("div",{className:"num3",children:"3"}),Object(b.jsx)("div",{className:"num2",children:"2"}),Object(b.jsx)("div",{className:"num1",children:"1"}),Object(b.jsxs)("div",{className:"num0",children:[Object(b.jsx)("h1",{children:R.name}),R.platforms.join(", ")]})]})});if(null===c)return Object(b.jsx)(h,{onValid:function(e){r(e)}});var U=function(e,t){A.current.connections[t][0].send({type:"sync",autres:e})},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(var n in A.current.connections)n!=="tirage-membre-"+t&&U(e,n)},M=function(e){w(e)},I=(null===u||void 0===u?void 0:u.created)&&3===p.length;if(I)for(var P=0,V=Object.values(S);P<V.length;P++){if(V[P].length<3){I=!1;break}}return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("h1",{children:["Salut ",c," !"]}),Object(b.jsx)("hr",{}),u?Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("div",{children:[Object(b.jsxs)("p",{children:["Tu as ",u.created?"cr\xe9\xe9":"rejoint"," le salon : ",u.code]}),Object(b.jsxs)("div",{className:"buttons",children:[u.created&&Object(b.jsx)("button",{disabled:!I,type:"submit",className:"btn btn-success",onClick:function(){var e,t=Object.values(E.current),n=t.length>0?t.reduce((function(e,t){var n,c=null!==e&&void 0!==e?e:[],a=Object(i.a)(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;c.push(r)}}catch(s){a.e(s)}finally{a.f()}return c})):[],c=Object(i.a)(p);try{for(c.s();!(e=c.n()).done;){var a=e.value;n.push(a)}}catch(l){c.e(l)}finally{c.f()}var r=n[Math.floor(Math.random()*n.length)];for(var s in A.current.connections){A.current.connections[s][0].send({type:"winner",winner:r})}M(r)},children:"Tirer au sort"}),Object(b.jsx)("button",{type:"submit",className:"btn btn-danger",onClick:function(){A.current.destroy(),m(null),g([]),C({})},children:"Quitter"})]})]}),Object(b.jsx)("hr",{}),Object(b.jsxs)("div",{children:[Object(b.jsx)("h2",{children:"Mes films"}),Object(b.jsxs)("table",{className:"table",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{scope:"col",children:"Nom"}),Object(b.jsx)("th",{scope:"col",children:"Plateformes"}),Object(b.jsx)("th",{scope:"col"})]})}),Object(b.jsxs)("tbody",{children:[p.map((function(e,t){return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:e.name}),Object(b.jsx)("td",{children:e.platforms.join(", ")}),Object(b.jsx)("td",{children:Object(b.jsx)("button",{type:"button",className:"btn btn-danger",onClick:function(){return function(e){var t=p.slice();t.splice(e,1),g(t),u.created?L(Object.assign({},E.current,Object(l.a)({},c,t))):Object.values(A.current.connections)[0][0].send({type:"remove",index:e})}(t)},children:Object(b.jsx)("i",{className:"bi bi-trash-fill"})})})]},e.name)})),p.length<3&&Object(b.jsx)(O,{onAjouter:function(e){var t=p.slice();t.push(e),g(t),u.created?L(Object.assign({},E.current,Object(l.a)({},c,t))):Object.values(A.current.connections)[0][0].send({type:"add",film:e})}})]})]})]}),Object.values(S).length>0&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("hr",{}),Object(b.jsx)("h2",{children:"Les autres participants"}),Object(b.jsx)("table",{className:"table",children:Object(b.jsx)("tbody",{children:Object.entries(S).map((function(e){var t=Object(j.a)(e,2),n=t[0],c=t[1];return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:n}),Object(b.jsxs)("td",{children:[c.length," film",c.length>1&&"s"]})]},n)}))})})]})]}):Object(b.jsx)(f,{onCreer:function(){var e=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=n.length,a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*c));return t}(),t=new d.a("tirage-salon-"+e,{debug:3});A.current=t,t.on("connection",(function(e){var t;e.on("data",(function(e){if(console.log("DATA!"),console.log(e),"hello"===e.type){t=e.name,U(Object.assign({},E.current,Object(l.a)({},D.current,T.current)),"tirage-membre-"+t);var n=Object.assign({},E.current,Object(l.a)({},t,[]));C(n)}else if("add"===e.type){var c=Object.assign({},E.current);c[t]=c[t].slice(),c[t].push(e.film),L(Object.assign({},c,Object(l.a)({},D.current,T.current)),t),C(c)}else if("remove"===e.type){var a=Object.assign({},E.current);a[t]=a[t].slice(),a[t].splice(e.index,1),L(Object.assign({},a,Object(l.a)({},D.current,T.current)),t),C(a)}})),e.on("close",(function(){console.log("CLOSE: "+t);var e=Object.assign({},E.current);delete e[t],L(Object.assign({},e,Object(l.a)({},D.current,T.current)),t),C(e)}))})),m({code:e,created:!0})},onRejoindre:function(e){return new Promise((function(t,n){var a=new d.a("tirage-membre-"+c,{debug:3});A.current=a,a.on("error",(function(e){console.log("ERROR"),console.log(e),n(e)})),a.on("open",(function(){var r=a.connect("tirage-salon-"+e,{});r.on("open",(function(){r.send({type:"hello",name:c}),m({code:e,created:!1}),g([]),C({}),t()})),r.on("data",(function(e){console.log("DATA!"),console.log(e),"sync"===e.type?(delete e.autres[c],C(e.autres)):"winner"===e.type&&M(e.winner)})),r.on("error",(function(e){console.log("ERROR"),console.log(e),n(e)})),r.on("close",(function(){m(null)}))}))}))}})]})},x=function(e){return Object(b.jsx)("div",{className:"container",children:Object(b.jsx)(v,{})})},p=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};s.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(x,{})}),document.getElementById("root")),p()}},[[20,1,2]]]);
//# sourceMappingURL=main.8ad33506.chunk.js.map