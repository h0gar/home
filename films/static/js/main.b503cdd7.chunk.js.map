{"version":3,"sources":["../node_modules/peerjs/dist sync","App.js","reportWebVitals.js","index.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","capitalizeTheFirstLetterOfEachWord","words","separateWord","toLowerCase","split","i","length","charAt","toUpperCase","substring","join","NameInput","props","React","useState","name","setName","errors","setErrors","onSubmit","preventDefault","match","onValid","type","value","onChange","target","className","FilmForm","platforms","setPlatforms","Object","onAjouter","multiple","v","selectedOptions","map","o","SalonForm","setJoin","loading","setLoading","onRejoindre","catch","onClick","onCreer","App","salon","setSalon","films","setFilms","autres","setAutres","winner","setWinner","peerRef","useRef","nameRef","current","filmsRef","autresRef","syncToOne","autre","connections","send","syncToAll","except","showWinner","ready","created","values","destroy","autresArr","all","reduce","acc","r","f","push","Math","floor","random","copy","slice","splice","assign","index","supprimer","film","entries","result","characters","charactersLength","genCode","peer","Peer","on","conn","connName","data","Promise","reject","err","connect","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b503cdd7.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 16;","import React from 'react'\r\nimport Peer from 'peerjs'\r\n\r\nfunction genCode(length=5) {\r\n\tvar result           = '';\r\n\tvar characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n\tvar charactersLength = characters.length;\r\n\tfor ( var i = 0; i < length; i++ ) {\r\n\t\tresult += characters.charAt(Math.floor(Math.random() * \r\n\t\tcharactersLength));\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nfunction capitalizeTheFirstLetterOfEachWord(words) {\r\n   var separateWord = words.toLowerCase().split(' ');\r\n   for (var i = 0; i < separateWord.length; i++) {\r\n      separateWord[i] = separateWord[i].charAt(0).toUpperCase() +\r\n      separateWord[i].substring(1);\r\n   }\r\n   return separateWord.join(' ');\r\n}\r\n\r\nconst NameInput = props => {\r\n\tconst [name, setName] = React.useState('');\r\n\tconst [errors, setErrors] = React.useState({});\r\n\r\n\tconst onChange = e => {\r\n\t\tsetName(e.target.value);\r\n\t}\r\n\r\n\tconst onSubmit = e => {\r\n\t\te.preventDefault();\r\n\r\n\t\tif(name.match(/^[A-zÀ-ú]+$/))\r\n\t\t\tprops.onValid(name);\r\n\t\telse\r\n\t\t\tsetErrors({name: 'Choisir un nom avec des lettres uniquement.'});\r\n\t};\r\n\r\n\treturn <form onSubmit={onSubmit}>\r\n\t\t<div><input type=\"text\" name=\"name\" value={name} onChange={onChange} className={errors.name ? 'error':''}/></div>\r\n\t\t{errors.name && <p className=\"error-msg\">{errors.name}</p>}\r\n\t\t<div><button type=\"submit\">Valider</button></div>\r\n\t</form>\r\n}\r\n\r\nconst FilmForm = props => {\r\n\tconst [name, setName] = React.useState('');\r\n\tconst [platforms, setPlatforms] = React.useState([]);\r\n\tconst [errors, setErrors] = React.useState({});\r\n\r\n\tconst onChangeName = e => {\r\n\t\tsetName(e.target.value);\r\n\t}\r\n\r\n\tconst onChangePlatforms = e => {\r\n\t\tlet v = [...e.target.selectedOptions].map(o => o.value);\r\n\t\tsetPlatforms(v);\r\n\t}\r\n\r\n\tconst onSubmit = e => {\r\n\t\te.preventDefault();\r\n\r\n\t\tlet errors = {};\r\n\t\tif(name.length === 0)\r\n\t\t\terrors.name = \"Faut choisir le nom d'un film !\";\r\n\t\tif(platforms.length === 0)\r\n\t\t\terrors.platforms = \"Faut choisir au moins une plateforme !\";\r\n\r\n\t\tsetErrors(errors);\r\n\r\n\t\tif(Object.keys(errors).length === 0) {\r\n\t\t\tprops.onAjouter({name: capitalizeTheFirstLetterOfEachWord(name), platforms});\r\n\t\t\tsetName('');\r\n\t\t\tsetPlatforms([]);\r\n\t\t}\r\n\t};\r\n\r\n\treturn <form onSubmit={onSubmit}>\r\n\t\t<div><input type=\"text\" value={name} onChange={onChangeName} className={errors.name ? 'error':''}/></div>\r\n\t\t{errors.name && <p className=\"error-msg\">{errors.name}</p>}\r\n\t\t<div>\r\n\t\t\t<select multiple value={platforms} onChange={onChangePlatforms} className={errors.platforms ? 'error':''}>\r\n\t\t\t\t<option>Netflix</option>\r\n\t\t\t\t<option>Amazon</option>\r\n\t\t\t\t<option>Disney</option>\r\n\t\t\t\t<option>OCS</option>\r\n\t\t\t\t<option>Salto</option>\r\n\t\t\t\t<option>Canal+</option>\r\n\t\t\t\t<option>Apple TV</option>\r\n\t\t\t</select>\r\n\t\t</div>\r\n\t\t{errors.platforms && <p className=\"error-msg\">{errors.platforms}</p>}\r\n\t\t<button type=\"submit\">ajouter</button>\r\n\t</form>\r\n}\r\n\r\nconst SalonForm = props => {\r\n\tconst [join, setJoin] = React.useState(false);\r\n\tconst [name, setName] = React.useState('');\r\n\tconst [errors, setErrors] = React.useState({});\r\n\tconst [loading, setLoading] = React.useState(false);\r\n\r\n\tif(join) {\r\n\t\tconst onChangeName = e => {\r\n\t\t\tsetName(e.target.value);\r\n\t\t}\r\n\r\n\t\tconst onSubmit = e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tsetLoading(true);\r\n\t\t\tprops.onRejoindre(name)\r\n\t\t\t\t// .then(() => {\r\n\t\t\t\t// \t// console.log('!')\r\n\t\t\t\t// \tsetLoading(false);\r\n\t\t\t\t// \tsetName('');\r\n\t\t\t\t// \tsetJoin(false);\r\n\t\t\t\t// })\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t\t// console.log(e)\r\n\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\tsetErrors({name: 'Impossible de rejoindre ce salon'});\r\n\t\t\t\t})\r\n\t\t\t\t;\r\n\t\t};\r\n\r\n\t\tif(loading)\r\n\t\t\treturn <>Chargement...</>\r\n\r\n\t\treturn <form onSubmit={onSubmit}>\r\n\t\t\t<div><input type=\"text\" value={name} onChange={onChangeName} className={errors.name ? 'error':''}/></div>\r\n\t\t\t{errors.name && <p className=\"error-msg\">{errors.name}</p>}\r\n\t\t\t<button type=\"submit\">confirmer</button>\r\n\t\t</form>\r\n\t}\r\n\r\n\treturn <>\r\n\t\t<button type=\"button\" onClick={props.onCreer}>créer</button>\r\n\t\t<button type=\"button\" onClick={() => setJoin(true)}>rejoindre</button>\r\n\t</>\r\n}\r\n\r\nconst App = props => {\r\n\tconst [name, setName] = React.useState(null);\r\n\t// const [name, setName] = React.useState('bob');\r\n\tconst [salon, setSalon] = React.useState(null);\r\n\tconst [films, setFilms] = React.useState([]);\r\n\t// const [films, setFilms] = React.useState([{name: 'b', platforms: ['Netflix']}]);\r\n\tconst [autres, setAutres] = React.useState({});\r\n\t// const [autres, setAutres] = React.useState({Michel: [{name: 'a', platforms: ['Netflix']}]});\r\n\r\n\tconst [winner, setWinner] = React.useState(null);\r\n\r\n\tconst peerRef = React.useRef();\r\n\t// const connsRef = React.useRef({});\r\n\t// const connRef = React.useRef(null);\r\n\t// const autresRef = React.useRef({});\r\n\r\n\t// const setAutres = v => {\r\n\t// \tautresRef.current = v;\r\n\t// \t_setAutres(v);\r\n\t// };\r\n\r\n\tconst nameRef = React.useRef();\r\n\tnameRef.current = name;\r\n\tconst filmsRef = React.useRef();\r\n\tfilmsRef.current = films;\r\n\tconst autresRef = React.useRef();\r\n\tautresRef.current = autres;\r\n\r\n\t// return <>\r\n\t// \t<div id=\"webkit-keyframes-animation\">Je me réduis</div>\r\n\t// </>\r\n\r\n\t// React.useEffect(() => {\r\n\t// \tsetWinner({\r\n\t// \t\tname: 'Blabla',\r\n\t// \t\tplatforms: ['Netflix', 'Amazon']\r\n\t// \t});\r\n\t// }, []);\r\n\r\n\tif(winner) {\r\n\t\treturn <>\r\n\t\t\t<div className=\"countdown\">\r\n\t\t\t\t<div className=\"num5\">5</div>\r\n\t\t\t\t<div className=\"num4\">4</div>\r\n\t\t\t\t<div className=\"num3\">3</div>\r\n\t\t\t\t<div className=\"num2\">2</div>\r\n\t\t\t\t<div className=\"num1\">1</div>\r\n\t\t\t\t<div className=\"num0\">\r\n\t\t\t\t\t<h1>{winner.name}</h1>\r\n\t\t\t\t\t{winner.platforms.join(', ')}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t}\r\n\r\n\tif(name === null) {\r\n\t\treturn <NameInput onValid={name => {\r\n\t\t\tsetName(name);\r\n\t\t}}/>\r\n\t}\r\n\r\n\tconst syncToOne = (autres, autre) => {\r\n\t\t// let conn = connsRef.current[autre];\r\n\t\t// console.log(peerRef.current.connections)\r\n\t\t// console.log(Object.keys(peerRef.current.connections))\r\n\t\t// console.log(autre)\r\n\t\t// console.log(peerRef.current.connections['tirage-membre-'+autre])\r\n\t\tlet conn = peerRef.current.connections[autre][0];\r\n\t\tconn.send({\r\n\t\t\ttype: 'sync',\r\n\t\t\tautres: autres,\r\n\t\t});\r\n\t};\r\n\r\n\tconst syncToAll = (autres, except=null) => {\r\n\t\t// for(let autre in connsRef.current) {\r\n\t\t\t// if(autre === except)\r\n\t\tfor(let autre in peerRef.current.connections) {\r\n\t\t\tif(autre === 'tirage-membre-'+except)\r\n\t\t\t\tcontinue;\r\n\t\t\tsyncToOne(autres, autre);\r\n\t\t}\r\n\t};\r\n\r\n\tconst showWinner = winner => {\r\n\t\t// console.log(winner)\r\n\t\tsetWinner(winner);\r\n\t\t// TODO\r\n\t};\r\n\r\n\tconst onCreerSalon = () => {\r\n\t\tlet code = genCode();\r\n\r\n\t\tconst peer = new Peer('tirage-salon-'+code, {\r\n\t\t\t// debug: 3\r\n\t\t});\r\n\t\tpeerRef.current = peer;\r\n\t\tpeer.on('connection', (conn) => {\r\n\t\t\tlet connName;\r\n\r\n\t\t\tconn.on('data', (data) => {\r\n\t\t\t\t// console.log('DATA!')\r\n\t\t\t\t// console.log(data)\r\n\t\t\t\tif(data.type === 'hello') {\r\n\t\t\t\t\tconnName = data.name;\r\n\t\t\t\t\t// connsRef.current[data.name] = conn;\r\n\r\n\t\t\t\t\tsyncToOne(Object.assign({}, autresRef.current, {[nameRef.current]: filmsRef.current}), 'tirage-membre-'+connName);\r\n\r\n\t\t\t\t\tlet copy = Object.assign({}, autresRef.current, {[connName]: []});\r\n\t\t\t\t\tsetAutres(copy);\r\n\t\t\t\t}\r\n\t\t\t\telse if(data.type === 'add') {\r\n\t\t\t\t\t// console.log(autresRef.current)\r\n\t\t\t\t\tlet copy = Object.assign({}, autresRef.current);\r\n\t\t\t\t\tcopy[connName] = copy[connName].slice();\r\n\t\t\t\t\tcopy[connName].push(data.film);\r\n\r\n\t\t\t\t\tsyncToAll(Object.assign({}, copy, {[nameRef.current]: filmsRef.current}), connName);\r\n\r\n\t\t\t\t\tsetAutres(copy);\r\n\t\t\t\t}\r\n\t\t\t\telse if(data.type === 'remove') {\r\n\t\t\t\t\tlet copy = Object.assign({}, autresRef.current);\r\n\t\t\t\t\tcopy[connName] = copy[connName].slice();\r\n\t\t\t\t\tcopy[connName].splice(data.index, 1);\r\n\r\n\t\t\t\t\tsyncToAll(Object.assign({}, copy, {[nameRef.current]: filmsRef.current}), connName);\r\n\r\n\t\t\t\t\tsetAutres(copy);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconn.on('close', () => {\r\n\t\t\t\t\tlet copy = Object.assign({}, autresRef.current);\r\n\t\t\t\t\tdelete copy[connName];\r\n\r\n\t\t\t\t\tsyncToAll(Object.assign({}, copy, {[nameRef.current]: filmsRef.current}), connName);\r\n\r\n\t\t\t\t\tsetAutres(copy);\r\n\t\t\t});\r\n\t\t\t// conn.on('open', () => {\r\n\t\t\t// \tconsole.log('salon:open')\r\n\t\t\t// \tconn.send('hello!');\r\n\t\t\t// });\r\n\t\t});\r\n\r\n\t\tsetSalon({code, created: true});\r\n\t};\r\n\r\n\tconst onRejoindreSalon = code => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst peer = new Peer('tirage-membre-'+name, {\r\n\t\t\t\t// debug: 3\r\n\t\t\t});\r\n\t\t\tpeerRef.current = peer;\r\n\t\t\tpeer.on('error', err => {\r\n\t\t\t\treject(err);\r\n\t\t\t});\r\n\t\t\tpeer.on('open', () => {\r\n\t\t\t\tconst conn = peer.connect('tirage-salon-'+code, {\r\n\t\t\t\t\t// reliable: true\r\n\t\t\t\t});\r\n\t\t\t\t// connRef.current = conn;\r\n\t\t\t\tconn.on('open', () => {\r\n\t\t\t\t\t// console.log('open')\r\n\t\t\t\t\tconn.send({\r\n\t\t\t\t\t\ttype: 'hello',\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetSalon({code, created: false});\r\n\t\t\t\t\tsetFilms([]);\r\n\t\t\t\t\tsetAutres({});\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t\t\tconn.on('data', data => {\r\n\t\t\t\t\t// console.log('DATA!')\r\n\t\t\t\t\t// console.log(data)\r\n\t\t\t\t\tif(data.type === 'sync') {\r\n\t\t\t\t\t\tdelete data.autres[name];\r\n\t\t\t\t\t\tsetAutres(data.autres);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(data.type === 'winner') {\r\n\t\t\t\t\t\tshowWinner(data.winner);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tconn.on('error', err => {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t});\r\n\t\t\t\tconn.on('close', () => {\r\n\t\t\t\t\tsetSalon(null);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tconst supprimer = i => {\r\n\t\tlet copy = films.slice();\r\n\t\tcopy.splice(i, 1);\r\n\t\tsetFilms(copy);\r\n\r\n\t\tif(salon.created)\r\n\t\t\tsyncToAll(Object.assign({}, autresRef.current, {[name]: copy}));\r\n\t\telse {\r\n\t\t\t// connRef.current.send({\r\n\t\t\tObject.values(peerRef.current.connections)[0][0].send({\r\n\t\t\t\ttype: 'remove',\r\n\t\t\t\tindex: i,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tconst ajouter = film => {\r\n\t\tlet copy = films.slice();\r\n\t\tcopy.push(film);\r\n\t\tsetFilms(copy);\r\n\r\n\t\tif(salon.created)\r\n\t\t\tsyncToAll(Object.assign({}, autresRef.current, {[name]: copy}));\r\n\t\telse {\r\n\t\t\t// connRef.current.send({\r\n\t\t\t// console.log(peerRef.current.connections)\r\n\t\t\tObject.values(peerRef.current.connections)[0][0].send({\r\n\t\t\t\ttype: 'add',\r\n\t\t\t\tfilm,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst onQuitterSalon = () => {\r\n\t\tpeerRef.current.destroy();\r\n\t\tsetSalon(null);\r\n\t\tsetFilms([]);\r\n\t\tsetAutres({});\r\n\t};\r\n\r\n\tconst onTirageAuSort = () => {\r\n\t\tlet autresArr = Object.values(autresRef.current)\r\n\t\tlet all = \r\n\t\t\tautresArr.length > 0 ?\r\n\t\t\t\tautresArr.reduce((acc, v) => {\r\n\t\t\t\t\tlet r = acc ?? [];\r\n\t\t\t\t\tfor(let f of v.films)\r\n\t\t\t\t\t\tr.push(f);\r\n\t\t\t\t\treturn r;\r\n\t\t\t\t})\r\n\t\t\t\t:\r\n\t\t\t\t[]\r\n\t\t;\r\n\t\tfor(let f of films)\r\n\t\t\tall.push(f);\r\n\t\t// console.log(all);\r\n\r\n\t\tlet winner = all[Math.floor(Math.random() * all.length)];\r\n\t\t// console.log(winner)\r\n\r\n\t\t// for(let autre in connsRef.current) {\r\n\t\t// \tlet conn = connsRef.current[autre];\r\n\t\tfor(let autre in peerRef.current.connections) {\r\n\t\t\tlet conn = peerRef.current.connections[autre][0];\r\n\t\t\tconn.send({\r\n\t\t\t\ttype: 'winner',\r\n\t\t\t\twinner,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tshowWinner(winner);\r\n\t};\r\n\r\n\tlet ready = salon?.created && films.length === 3;\r\n\tif(ready) {\r\n\t\tfor(let autre of Object.values(autresRef.current)) {\r\n\t\t\tif(autre.length < 3) {\r\n\t\t\t\tready = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn <>\r\n\t\t<div>Salut {name}</div>\r\n\t\t{\r\n\t\t\t!salon ?\r\n\t\t\t\t<SalonForm onCreer={onCreerSalon} onRejoindre={onRejoindreSalon}/>\r\n\t\t\t\t:\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\tVous avez {salon.created ? 'créé':'rejoint'} le salon : {salon.code}<br/>\r\n\t\t\t\t\t\t<span className=\"link\" onClick={onQuitterSalon}>Quitter</span><br/>\r\n\t\t\t\t\t\t{ready && <span className=\"link\" onClick={onTirageAuSort}>Tirer au sort</span>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<b>Mes films</b>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t{films.map((f, i) => (<li key={f.name}>\r\n\t\t\t\t\t\t\t\t{f.name}<br/>\r\n\t\t\t\t\t\t\t\t{f.platforms.join(', ')}<br/>\r\n\t\t\t\t\t\t\t\t<span className=\"link\" onClick={() => supprimer(i)}>Supprimer</span>\r\n\t\t\t\t\t\t\t</li>))}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t{films.length < 3 && <FilmForm onAjouter={ajouter}/>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<b>Les autres</b>\r\n\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t{Object.entries(autres).map(([name, films]) => <li key={name}>\r\n\t\t\t\t\t\t\t\t{name} : {films.length} films\r\n\t\t\t\t\t\t\t</li>)}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t}\r\n\t</>\r\n}\r\n\r\nexport default App","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App.js'\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}